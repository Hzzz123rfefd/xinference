from xinference.client import Client


url = "http://114.67.101.49:9991"                  # your url
# authority if need
user = ""
password = ""
api_key = ""

# create client,api_key is option
client = Client(url,api_key=api_key)
model = client.get_model("mistral-instruct-v0.3")

# if exist lora config
# generate_config={"max_tokens": 1024,"lora_name": "finet1"}
generate_config={"max_tokens": 1024}
# Chat to LLM
answer = model.chat(
   messages=    [
       {"content": "[Conversation]\n客户服务平台元气销售出库金额(1d)在某个特定时间段内的最大值是多少？\n\n[Conception]\nall time filter always applied on end_date_key;\n华东: [alias]:华北,华南,华东,北京; [description]:这不是指地域，而是指部门名称\n\n\n[Dictionary]\n华北: 华北战区\n华东: 华东战区\n华南: 华南战区\n北京: 北京作战部\n\n[Indicator]\n\tName:客户服务平台元气销售出库金额(1d), Alias: [客户服务平台元气销售出库金额(1d)/客户服务平台元气销售出库金额(1d)], Comment:客户服务平台元气销售出库金额(1d)\n[Dimensions]\n\tName:product_name, Type:CATEGORICAL, Comment:产品名称\n\tName:product_status, Type:CONTINUOUS, Comment:产品状态\n\tName:product_type, Type:CONTINUOUS, Comment:产品类型\n\tName:product_source, Type:CONTINUOUS, Comment:产品来源\n\tName:material_category_name, Type:CATEGORICAL, Comment:物料类别名称\n\tName:material_base_unit_name, Type:CATEGORICAL, Comment:物料基本单位名称\n\tName:base_unit_name, Type:CATEGORICAL, Comment:基本单位名称\n\tName:store_unit_name, Type:CATEGORICAL, Comment:库存单位名称\n\tName:store_gross_weight, Type:CONTINUOUS, Comment:库存单位毛重(kg)\n\tName:store_net_weight, Type:CONTINUOUS, Comment:库存单位净重(kg)\n\tName:is_store_exp, Type:CATEGORICAL, Comment:是否启用保质期\n\tName:store_exp_unit, Type:CATEGORICAL, Comment:保质期单位\n\tName:store_exp_period, Type:CONTINUOUS, Comment:保质期单位数量\n\tName:store_exp_calc_days, Type:CONTINUOUS, Comment:保质期计算天数\n\tName:store_ur_nom, Type:CONTINUOUS, Comment:库存单位转换分母\n\tName:store_ur_num, Type:CONTINUOUS, Comment:库存单位转换分子\n\tName:brand_name, Type:CATEGORICAL, Comment:产品品牌名称\n\tName:sub_brand_code, Type:CATEGORICAL, Comment:产品子品牌名称\n\tName:is_brand_belongs_group, Type:CATEGORICAL, Comment:产品品牌是否属于集团\n\tName:series_name, Type:CATEGORICAL, Comment:产品系列名称\n\tName:series_feature, Type:CATEGORICAL, Comment:产品系列特征\n\tName:spu_name, Type:CATEGORICAL, Comment:产品spu名称\n\tName:spu_flavor, Type:CATEGORICAL, Comment:产品口味\n\tName:spu_preservation_temp, Type:CATEGORICAL, Comment:产品温带\n\tName:spu_common_name, Type:CATEGORICAL, Comment:产品通用名\n\tName:product_item_name, Type:CATEGORICAL, Comment:产品ITEM名称\n\tName:product_item_net_content, Type:CONTINUOUS, Comment:产品ITEM净含量\n\tName:product_net_content, Type:CONTINUOUS, Comment:总净含量\n\tName:net_content_unit, Type:CATEGORICAL, Comment:净含量单位\n\tName:inner_package, Type:CATEGORICAL, Comment:内包装\n\tName:quantity, Type:CONTINUOUS, Comment:产品对应的基准产品数量\n\tName:product_item_net_content_text, Type:CATEGORICAL, Comment:产品ITEM规格文本\n\tName:product_feature, Type:CATEGORICAL, Comment:产品特性\n\tName:net_content_text, Type:CATEGORICAL, Comment:产品规格文本\n\tName:outer_package, Type:CATEGORICAL, Comment:外包装\n\tName:brand_source_name, Type:CATEGORICAL, Comment:产品品牌来源名称\n\tName:product_category_name, Type:CATEGORICAL, Comment:系列大类名称\n\tName:minimal_number, Type:CONTINUOUS, Comment:单元组成数量\n\tName:box_quantity_spec, Type:CONTINUOUS, Comment:箱规\n\tName:brand_status, Type:CONTINUOUS, Comment:品牌状态\n\tName:series_status, Type:CONTINUOUS, Comment:系列状态\n\tName:tag_budget_category_name, Type:CATEGORICAL, Comment:标签-预算品类名称\n\tName:tag_market_category_name, Type:CATEGORICAL, Comment:标签-市场部品类名称\n\tName:tag_market_62_category_name, Type:CATEGORICAL, Comment:标签-市场部6+2品类名称\n\tName:tag_is_shop_required, Type:CATEGORICAL, Comment:标签-是否门店必铺SKU\n\tName:indicator_dept_name, Type:CATEGORICAL, Comment:经销商账户业绩直接归属部门名称\n[Filters]\n\tName:end_date_key, Type:DATE_AND_TIME, Comment:统计周期结束日期, Format:\"yyyyMMdd\",, Sample Values:[20240726,etc..]\n\tName:product_name, Type:CATEGORICAL, Comment:产品名称, Sample Values:[元气森林-平野西打酒-凤梨百香果 铝罐330ml*1,元气自在水-谷物水-红豆薏米 PET500ml*1 (元气森林出品-电商),元气自在水-谷物水-红枣枸杞 PET500ml*1 (23年元气森林出品),元气自在水-谷物水-红枣枸杞 PET500ml*1 (元气森林出品-电商),etc..]\n\tName:product_status, Type:CONTINUOUS, Comment:产品状态\n\tName:product_type, Type:CONTINUOUS, Comment:产品类型\n\tName:product_source, Type:CONTINUOUS, Comment:产品来源\n\tName:material_category_name, Type:CATEGORICAL, Comment:物料类别名称, Sample Values:[绝对元气,元气自在水-谷物水,元气森林,停用-元气森林-森林的木,etc..]\n\tName:material_base_unit_name, Type:CATEGORICAL, Comment:物料基本单位名称, Sample Values:[桶,罐,Pcs,支,etc..]\n\tName:base_unit_name, Type:CATEGORICAL, Comment:基本单位名称, Sample Values:[桶,罐,Pcs,支,etc..]\n\tName:store_unit_name, Type:CATEGORICAL, Comment:库存单位名称, Sample Values:[桶,罐,Pcs,支,etc..]\n\tName:store_gross_weight, Type:CONTINUOUS, Comment:库存单位毛重(kg)\n\tName:store_net_weight, Type:CONTINUOUS, Comment:库存单位净重(kg)\n\tName:is_store_exp, Type:CATEGORICAL, Comment:是否启用保质期, Sample Values:[false,true,etc..]\n\tName:store_exp_unit, Type:CATEGORICAL, Comment:保质期单位, Sample Values:[d,m,y,etc..]\n\tName:store_exp_period, Type:CONTINUOUS, Comment:保质期单位数量\n\tName:store_exp_calc_days, Type:CONTINUOUS, Comment:保质期计算天数\n\tName:store_ur_nom, Type:CONTINUOUS, Comment:库存单位转换分母\n\tName:store_ur_num, Type:CONTINUOUS, Comment:库存单位转换分子\n\tName:brand_name, Type:CATEGORICAL, Comment:产品品牌名称, Sample Values:[元气满满,元气自在水,元气森林,元气早餐,etc..]\n\tName:sub_brand_code, Type:CATEGORICAL, Comment:产品子品牌名称, Sample Values:[WCS,VCS,SCS,ZNS,etc..]\n\tName:is_brand_belongs_group, Type:CATEGORICAL, Comment:产品品牌是否属于集团, Sample Values:[false,true,etc..]\n\tName:series_name, Type:CATEGORICAL, Comment:产品系列名称, Sample Values:[元气自在水-谷物水,元气森林-CAN,元气森林-经典,元气森林-平野西打酒,etc..]\n\tName:series_feature, Type:CATEGORICAL, Comment:产品系列特征, Sample Values:[核心,元气森林乳茶,轻酪时分,CAN,etc..]\n\tName:spu_name, Type:CATEGORICAL, Comment:产品spu名称, Sample Values:[元气自在水-谷物水-金银花雪梨水,元气森林-CAN-白桃,元气自在水-谷物水-绿豆水,元气森林-CAN-卡曼橘,etc..]\n\tName:spu_flavor, Type:CATEGORICAL, Comment:产品口味, Sample Values:[52°,茉香奶绿,金翘茶,多莓五红茶,etc..]\n\tName:spu_preservation_temp, Type:CATEGORICAL, Comment:产品温带, Sample Values:[C,组合,B,A,etc..]\n\tName:spu_common_name, Type:CATEGORICAL, Comment:产品通用名, Sample Values:[汽水,椰汁,大米原味粉,速食面,etc..]\n\tName:product_item_name, Type:CATEGORICAL, Comment:产品ITEM名称, Sample Values:[元气森林-CAN-白桃 铝罐330ml,元气自在水-谷物水-金银花雪梨水 PET500ml,元气自在水-谷物水-红豆薏米 PET500ml(元气森林出品),元气森林-经典-白桃 PET480ml,etc..]\n\tName:product_item_net_content, Type:CONTINUOUS, Comment:产品ITEM净含量\n\tName:product_net_content, Type:CONTINUOUS, Comment:总净含量\n\tName:net_content_unit, Type:CATEGORICAL, Comment:净含量单位, Sample Values:[ml,g,,etc..]\n\tName:inner_package, Type:CATEGORICAL, Comment:内包装, Sample Values:[PE,铁罐,铝罐,纸板桶,etc..]\n\tName:quantity, Type:CONTINUOUS, Comment:产品对应的基准产品数量\n\tName:product_item_net_content_text, Type:CATEGORICAL, Comment:产品ITEM规格文本, Sample Values:[275ml,380ml,250ml,280ml,etc..]\n\tName:product_feature, Type:CATEGORICAL, Comment:产品特性, Sample Values:[元气森林出品,元气森林出品-电商,23年元气森林出品,电商专供,etc..]\n\tName:net_content_text, Type:CATEGORICAL, Comment:产品规格文本, Sample Values:[280ml*1,330ml*24,250ml*1,480ml*1,etc..]\n\tName:outer_package, Type:CATEGORICAL, Comment:外包装, Sample Values:[周边款,待确定,大象的旅程联名礼盒,纸盒装,etc..]\n\tName:brand_source_name, Type:CATEGORICAL, Comment:产品品牌来源名称, Sample Values:[代理品牌,代工产品,自有产品,外购产品,etc..]\n\tName:product_category_name, Type:CATEGORICAL, Comment:系列大类名称, Sample Values:[乳品,食品,饮料,,etc..]\n\tName:minimal_number, Type:CONTINUOUS, Comment:单元组成数量\n\tName:box_quantity_spec, Type:CONTINUOUS, Comment:箱规\n\tName:brand_status, Type:CONTINUOUS, Comment:品牌状态\n\tName:series_status, Type:CONTINUOUS, Comment:系列状态\n\tName:tag_budget_category_name, Type:CATEGORICAL, Comment:标签-预算品类名称, Sample Values:[Cocalero,元气森林气泡水,外购品,代工品,etc..]\n\tName:tag_market_category_name, Type:CATEGORICAL, Comment:标签-市场部品类名称, Sample Values:[元气森林气泡水,纤茶,冰茶,植物茶,etc..]\n\tName:tag_market_62_category_name, Type:CATEGORICAL, Comment:标签-市场部6+2品类名称, Sample Values:[超级燃,Cocalero,元气森林气泡水,WAVE,etc..]\n\tName:tag_is_shop_required, Type:CATEGORICAL, Comment:标签-是否门店必铺SKU, Sample Values:[false,true,etc..]\n\tName:indicator_dept_name, Type:CATEGORICAL, Comment:经销商账户业绩直接归属部门名称, Sample Values:[销售中台,大客户组,销售支持部,销售后台,etc..]\n\tName:客户服务平台元气销售出库金额(1d), Type: Continuous, Comment: , Alias: [客户服务平台元气销售出库金额(1d)/客户服务平台元气销售出库金额(1d)]\n\n\n[INSTRUCTIONS]\nyou need to think about the goal of conversation carefully.\nDo not have any explanatory text, just return json as required. the json without markdown format.\nIf you have found indicators that can be used to answer the question, please return the indicators name and the required parameters.\nThe expression uses SQL syntax and satisfies the following constraints.\n\nPOP is for period over period analysis, and PROPORTION is for proportion analysis.\nthere may be no analysis in the conversation, in this case, the analysis should be empty.\n\n[OUTPUT FORMAT]\n{\n    \"indicators\": [\n        {\n            \"name\": \"indicator name mentioned in the conversation\",\n            \"relevance\": \"relevance of the indicator to the conversation, e.g. high, medium, low, don't output if no indicator matched\"\n        }\n    ],\n    \"time_range\": [\n        {\n            \"name\": \"time column name, should be one of the dimension that have DATE_AND_TIME type in the conversation\",\n            \"relevance\": \"relevance of the time_range to the conversation, e.g. high, medium, low, don't output if no time_range matched\"\n        }\n    ],\n    \"filters\": [\n        {\n            \"name\": \"filter name, should be the filter names not selected by time_range above, or indicator names if the indicator is used as a filter in the conversation\",\n            \"relevance\": \"relevance of the filter to the conversation, e.g. high, medium, low, don't output if no filter matched\"\n        }\n    ],\n    \"dimensions\": [\n        {\n            \"name\": \"dimension name, should be put in the sql template group by clause\",\n            \"relevance\": \"relevance of the dimension to the conversation, e.g. high, medium, low, don't output if no dimension matched\"\n        }\n    ],\n    \"analysis\": [\n        {\n            \"name\": \"function name, should leave empty if there is no analysis in the conversation or be one of: POP, PROPORTION\",\n            \"relevance\": \"relevance of the function name to the conversation, e.g. high, medium, low, don't output if no function name matched\"\n        }\n    ]\n}\n\n[OUTPUT]", "role": "user"}
    ],
   generate_config = generate_config
)
print(answer)
